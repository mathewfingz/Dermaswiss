{%- liquid
  assign sorted_blocks = section.blocks | sort: 'settings.event_date'
-%}

<div class="monthly-calendar-list container section-{{ section.id }}">
  <div class="calendar-header">
    <h1 class="h2">{{ section.settings.heading | default: 'Calendario de Eventos' }}</h1>
    {% if section.settings.description != blank %}
      <div class="calendar-description h5">{{ section.settings.description }}</div>
    {% endif %}
  </div>

  <div class="calendar-list">
    {%- if section.blocks.size > 0 -%}
      {%- assign previous_date = "" -%}
      {%- for block in sorted_blocks -%}
        {%- assign current_date = block.settings.event_date -%}
        
        {%- if current_date != previous_date -%}
          <div class="calendar-list__date-header">
            <span class="date-header__day">{{ current_date | date: "%d" }}</span>
            <div class="date-header__right">
              <span class="date-header__month">{{ current_date | date: "%B" | capitalize }}</span>
              <span class="date-header__year">{{ current_date | date: "%Y" }}</span>
            </div>
          </div>
        {%- endif -%}

        <div class="calendar-list__event" {{ block.shopify_attributes }}>
          <div class="event__color-bar" style="background-color: {{ block.settings.event_color }}"></div>
          <div class="event__content">
            <h3 class="event__title h4">{{ block.settings.title }}</h3>
            {% if block.settings.event_description != blank %}
              <div class="event__description rte">{{ block.settings.event_description }}</div>
            {% endif %}
          </div>
        </div>
        
        {%- assign previous_date = current_date -%}
      {%- endfor -%}
    {%- else -%}
      <div class="calendar-list__empty text-center">
        <p>No hay eventos programados en este momento.</p>
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  .monthly-calendar-list {
    margin-top: 60px;
    margin-bottom: 60px;
    max-width: 800px;
  }
  .calendar-header {
    text-align: center;
    margin-bottom: 50px;
  }
  .calendar-description {
    margin-top: 10px;
    color: rgba(var(--color-foreground), 0.7);
  }
  .calendar-list {
    display: flex;
    flex-direction: column;
    gap: 30px;
  }
  .calendar-list__date-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
  }
  .date-header__day {
    font-size: 3rem;
    font-weight: bold;
    line-height: 1;
    color: var(--color-primary);
  }
  .date-header__right {
    display: flex;
    flex-direction: column;
  }
  .date-header__month {
    font-weight: bold;
    text-transform: uppercase;
    font-size: 1.2rem;
    letter-spacing: 0.1rem;
  }
  .date-header__year {
    font-size: 1.1rem;
    color: #666;
  }
  .calendar-list__event {
    display: flex;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    overflow: hidden;
    transition: transform 0.2s ease;
    margin-left: 20px;
  }
  .calendar-list__event:hover {
    transform: translateX(5px);
  }
  .event__color-bar {
    width: 6px;
    flex-shrink: 0;
  }
  .event__content {
    padding: 20px 25px;
    flex-grow: 1;
  }
  .event__title {
    margin-bottom: 8px;
  }
  .event__description {
    font-size: 1.4rem;
    color: #444;
    line-height: 1.5;
  }
  @media (max-width: 767px) {
    .calendar-list__event {
      margin-left: 0;
    }
    .date-header__day {
      font-size: 2.2rem;
    }
  }
</style>

{% schema %}
{
  "name": "Calendario de Lista",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Encabezado",
      "default": "Próximos Eventos"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Descripción",
      "default": "<p>Mantente al día con nuestros próximos eventos y programas profesionales.</p>"
    }
  ],
  "blocks": [
    {
      "type": "event",
      "name": "Evento",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Título del Evento",
          "default": "Nuevo Evento"
        },
        {
          "type": "text",
          "id": "event_date",
          "label": "Fecha (YYYY-MM-DD)",
          "info": "Ejemplo: 2025-12-25",
          "default": "2025-12-25"
        },
        {
          "type": "richtext",
          "id": "event_description",
          "label": "Descripción del Evento"
        },
        {
          "type": "color",
          "id": "event_color",
          "label": "Color de etiqueta",
          "default": "#db0032"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Calendario de Lista",
      "blocks": [
        {
          "type": "event",
          "settings": {
            "title": "Evento de Masterclass",
            "event_date": "2025-12-25",
            "event_description": "<p>Únete a nuestra masterclass sobre técnicas avanzadas de skincare.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}

